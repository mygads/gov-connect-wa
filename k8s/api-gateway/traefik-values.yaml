# ==================== TRAEFIK HELM VALUES ====================
# Custom values untuk Traefik Helm chart
# Install: helm install traefik traefik/traefik -f traefik-values.yaml -n traefik --create-namespace

# Deployment configuration
deployment:
  replicas: 2
  annotations:
    app.kubernetes.io/part-of: govconnect

# Image
image:
  repository: traefik
  tag: "v3.0"
  pullPolicy: IfNotPresent

# Entry points (ports)
ports:
  web:
    port: 8000
    expose:
      default: true
    exposedPort: 80
    protocol: TCP
    # Redirect HTTP to HTTPS
    redirectTo:
      port: websecure
      priority: 10
  websecure:
    port: 8443
    expose:
      default: true
    exposedPort: 443
    protocol: TCP
    tls:
      enabled: true
  traefik:
    port: 9000
    expose:
      default: false
  metrics:
    port: 9100
    expose:
      default: false

# Service configuration
service:
  enabled: true
  type: LoadBalancer
  annotations:
    # For IPv4/IPv6 dual-stack
    service.kubernetes.io/ip-family-policy: PreferDualStack

# Traefik Dashboard
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.govconnect.my.id`)
    entryPoints:
      - websecure
    middlewares:
      - name: dashboard-auth

# Providers
providers:
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
    namespaces:
      - govconnect
      - traefik
  kubernetesIngress:
    enabled: true
    namespaces:
      - govconnect

# Logs configuration
logs:
  general:
    level: INFO
  access:
    enabled: true
    format: json
    fields:
      general:
        defaultMode: keep
      headers:
        defaultMode: drop
        names:
          User-Agent: keep
          Authorization: redact
          X-Internal-API-Key: redact

# Metrics for Prometheus
metrics:
  prometheus:
    entryPoint: metrics
    addEntryPointsLabels: true
    addServicesLabels: true
    addRoutersLabels: true

# Resource limits
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "256Mi"

# Pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Affinity - spread across nodes
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: traefik
          topologyKey: kubernetes.io/hostname

# Additional arguments
additionalArguments:
  - "--api.insecure=false"
  - "--api.dashboard=true"
  - "--ping=true"
  - "--entrypoints.web.http.redirections.entryPoint.to=websecure"
  - "--entrypoints.web.http.redirections.entryPoint.scheme=https"

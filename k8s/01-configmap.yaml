# ==================== GOVCONNECT CONFIGMAP ====================
# Non-sensitive configuration shared across services
apiVersion: v1
kind: ConfigMap
metadata:
  name: govconnect-config
  namespace: govconnect
  labels:
    app.kubernetes.io/name: govconnect
    app.kubernetes.io/component: config
data:
  # Node environment
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  
  # Service ports
  CHANNEL_SERVICE_PORT: "3001"
  AI_SERVICE_PORT: "3002"
  CASE_SERVICE_PORT: "3003"
  NOTIFICATION_SERVICE_PORT: "3004"
  DASHBOARD_PORT: "3000"
  
  # Internal service URLs (Kubernetes DNS)
  CHANNEL_SERVICE_URL: "http://channel-service:3001"
  AI_SERVICE_URL: "http://ai-service:3002"
  CASE_SERVICE_URL: "http://case-service:3003"
  NOTIFICATION_SERVICE_URL: "http://notification-service:3004"
  DASHBOARD_SERVICE_URL: "http://dashboard:3000"
  
  # External URLs (public access via ingress)
  # Dashboard at root domain, API at subdomain
  DASHBOARD_URL: "https://govconnect.my.id"
  API_GATEWAY_URL: "https://api.govconnect.my.id"
  WA_WEBHOOK_URL: "https://api.govconnect.my.id/webhook/whatsapp"
  
  # Database configuration (schema-per-service pattern)
  DB_HOST: "postgres"
  DB_PORT: "5432"
  DB_NAME: "govconnect"
  
  # RabbitMQ configuration
  RABBITMQ_HOST: "rabbitmq"
  RABBITMQ_PORT: "5672"
  RABBITMQ_VHOST: "govconnect"
  
  # LLM Configuration
  # Note: Model selection (primary/fallback) is configured via Dashboard AI Settings
  LLM_TEMPERATURE: "0.3"
  LLM_MAX_TOKENS: "2000"
  LLM_TIMEOUT_MS: "30000"
  MAX_HISTORY_MESSAGES: "30"
  
  # App name
  NEXT_PUBLIC_APP_NAME: "GovConnect Dashboard"
  
  # WhatsApp Webhook
  WA_WEBHOOK_VERIFY_TOKEN: "govconnect_verify_2025"

---
# ==================== DATABASE INIT SQL ====================
# Init script for PostgreSQL schemas
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-config
  namespace: govconnect
  labels:
    app.kubernetes.io/name: govconnect
    app.kubernetes.io/component: database
data:
  init-databases.sql: |
    -- GovConnect PostgreSQL Initialization Script
    -- Creates schemas for each microservice
    
    -- Enable pgvector extension
    CREATE EXTENSION IF NOT EXISTS vector;
    
    -- Create schemas for each service
    CREATE SCHEMA IF NOT EXISTS channel;
    CREATE SCHEMA IF NOT EXISTS cases;
    CREATE SCHEMA IF NOT EXISTS notification;
    CREATE SCHEMA IF NOT EXISTS dashboard;
    
    -- Grant permissions
    GRANT ALL PRIVILEGES ON SCHEMA channel TO postgres;
    GRANT ALL PRIVILEGES ON SCHEMA cases TO postgres;
    GRANT ALL PRIVILEGES ON SCHEMA notification TO postgres;
    GRANT ALL PRIVILEGES ON SCHEMA dashboard TO postgres;
    
    -- Log completion
    DO $$
    BEGIN
        RAISE NOTICE 'GovConnect database initialization complete';
        RAISE NOTICE 'Schemas created: channel, cases, notification, dashboard';
    END $$;
